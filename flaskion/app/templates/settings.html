{% extends "base.html" %}

<!-- ページタイトル -->
{% block title %}Settings - Uwgen{% endblock %}

<!-- スタイルシート -->
{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/settings.css') }}">
<script type="module" defer src="{{ url_for('static', filename='js/settings.js') }}"></script>
{% endblock %}

<!-- コンテンツエリア -->
{% block content %}
<div class="settings-container">
    
    <!-- タイトル -->
    <h1 class="page-title">設定</h1>

    <form id="settings-form">

        <!-- Uwgen API Key -->
        <section class="setting-card">
            <h2 class="section-title">Uwgen APIキー</h2>

            <div class="form-group">
                <div class="api-key-row">
                    <div id="uwgen-api-key-display"
                        class="api-key-box {% if not user.uwgen_api_key %}unissued{% endif %}">
                        {{ masked_uwgen_api_key }}
                    </div>
                    <input type="hidden" id="uwgen-api-key" value="{{ user.uwgen_api_key }}">
                    <input type="hidden" id="original-uwgen-api-key" value="{{ user.uwgen_api_key }}">
                    <button type="button" id="regenerate-api-key-btn" class="btn small">
                        {% if user.uwgen_api_key %}再発行{% else %}発行{% endif %}
                    </button>
                </div>
                <!-- 保存ボタン押下注意メッセージ表示領域 -->
                <div id="uwgen-api-key-warning" class="warning-message" style="display:none;"></div>
            </div>
        </section>

        <!-- Gemini API Key -->
        <section class="setting-card">
            <h2 class="section-title">Gemini APIキー</h2>

            <div class="form-group">
                <label>現在の値</label>
                <div class="api-key-row">
                    <div id="gemini-api-key-display"
                        class="api-key-box {% if not user.gemini_api_key_encrypted %}unissued{% endif %}">
                        {{ masked_gemini_api_key }}
                    </div>
                </div>
                <label for="gemini-api-key">変更後の値</label>
                <div class="api-key-row">
                    <input type="password" id="gemini-api-key" class="api-key-input" placeholder="Gemini APIキーを入力">
                    <input type="hidden" id="original-gemini-api-key" value="{{ user.gemini_api_key_encrypted }}">
                </div>
            </div>

            <h2 class="section-title">Gemini(VertexAI) APIキー</h2>

            <div class="form-group">
                <label>現在の値</label>
                <div class="api-key-row">
                    <div id="gemini-api-key-vertexai-display"
                        class="api-key-box {% if not user.gemini_api_key_vertexai_encrypted %}unissued{% endif %}">
                        {{ masked_gemini_api_key_vertexai }}
                    </div>
                </div>
                <label for="gemini-api-key-vertexai">変更後の値</label>
                <div class="api-key-row">
                    <input type="password" id="gemini-api-key-vertexai" class="api-key-input" placeholder="Gemini(VertexAI) APIキーを入力">
                    <input type="hidden" id="original-gemini-api-key-vertexai" value="{{ user.gemini_api_key_vertexai_encrypted }}">
                </div>
            </div>
        </section>

        <!-- フッター保存ボタン -->
        <div class="settings-footer">
            <button type="button" id="save-settings-btn" class="btn blue">保存</button>
        </div>

        <!-- オーバーレイ + スピナー -->
        <div id="overlay" class="overlay" style="display:none;">
            <div class="spinner"></div>
        </div>

    </form>

    <!-- メッセージ表示欄 -->
    <div class="message-area"></div>

</div>
{% endblock %}